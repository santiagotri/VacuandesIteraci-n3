--ALTER SESSION SET CURRENT_SCHEMA = ISIS2304D06202110; --ramirez
ALTER SESSION SET CURRENT_SCHEMA = ISIS2304D10202110; -- triana


--.....................................................
--CREACION DE TABLAS
--.....................................................



--CIUDADANO
create table CIUDADANO (
    CEDULA NUMBER (15,0),
    NOMBRE_COMPLETO VARCHAR (50) NOT NULL,
    ESTADO_VACUNACION VARCHAR (50),
    REGION VARCHAR (20) NOT NULL,
    DESEA_SER_VACUNADO NUMBER(1) NOT NULL CHECK  (DESEA_SER_VACUNADO in (0,1)),
    PLAN_DE_VACUNACION NUMBER (15,0),
    PUNTO_VACUNACION NUMBER (15,0),
    OFICINA_REGIONAL_ASIGNADA NUMBER (15,0)
);


--USUARIO
create table USUARIO (
    USERNAME VARCHAR (20),
    CONTRASENA VARCHAR (30) NOT NULL,
    CORREO VARCHAR (320) NOT NULL,
    PLAN_DE_VACUNACION NUMBER (15,0) NOT NULL,
    CIUDADANO NUMBER (15,0) NOT NULL
);


--PLAN_DE_VACUNACION
create table PLAN_DE_VACUNACION (
    ID_PLAN_DE_VACUNACION NUMBER GENERATED AS IDENTITY (START with 1 increment by 1),
    NOMBRE VARCHAR (50) NOT NULL,
    DESCRIPCION VARCHAR (1000) NOT NULL,
    FECHA_ACTUALIZACION DATE NOT NULL
);


--MINISTERIO DE SALUD
create table MINISTERIO_DE_SALUD (
    ID_MINISTERIO NUMBER GENERATED AS IDENTITY (START with 1 increment by 1),
    PLAN_DE_VACUNACION NUMBER (15,0) NOT NULL
);


--PUNTO VACUNACION
create table PUNTO_VACUNACION (
    ID_PUNTO_VACUNACION NUMBER GENERATED AS IDENTITY (START with 1 increment by 1),
    LOCALIZACION VARCHAR (50) NOT NULL,
    CAPACIDAD_DE_ATENCION_SIMULTANEA NUMBER (6,0) NOT NULL,
    INFRAESTRUCTURA_PARA_DOSIS  VARCHAR (50) NOT NULL,
    CANTIDAD_VACUNAS_ENVIABLES NUMBER (6,0) NOT NULL,
    CANTIDAD_VACUNAS_ACTUALES NUMBER (6,0) NOT NULL,
    TIPO_PUNTO_VACUNACION VARCHAR (50) NOT NULL,
    ADMINISTRADOR VARCHAR (20) NOT NULL,
    OFICINA_REGIONAL_EPS NUMBER(15,0) NOT NULL
);


--CITA
create table CITA (
    ID_CITA NUMBER GENERATED AS IDENTITY (START with 1 increment by 1),
    FECHA DATE NOT NULL,
    CIUDADANO NUMBER (15,0) NOT NULL,
    PUNTO_VACUNACION NUMBER (15,0) NOT NULL,
    VACUNA NUMBER (15,0) NOT NULL,
    HORA_CITA NUMBER (6,0) NOT NULL
);


--TRABAJADOR
create table TRABAJADOR (
    CEDULA NUMBER (15,0),
    TRABAJO VARCHAR(50) NOT NULL,
    ADMINISTRADOR_VACUANDES NUMBER(1) NOT NULL CHECK  (ADMINISTRADOR_VACUANDES in (0,1)),
    PUNTO_VACUNACION NUMBER (15,0)
);

--VACUNA
create table VACUNA (
    ID_VACUNA NUMBER GENERATED AS IDENTITY (START with 1 increment by 1),
    CONDICION_PRESERVACION VARCHAR(50) NOT NULL,
    PUNTO_VACUNACION NUMBER (15,0) NOT NULL,
    PLAN_DE_VACUNACION NUMBER (15,0) NOT NULL,
    OFICINA_REGIONAL NUMBER (15,0) NOT NULL,
    UTILIZADA NUMBER(1) NOT NULL CHECK  (UTILIZADA in (0,1))
);

--OFICINA REGIONAL EPS
create table OFICINA_REGIONAL_EPS (
    ID_OFICINA NUMBER GENERATED AS IDENTITY (START with 1 increment by 1),
    REGION VARCHAR(50) NOT NULL,
    ADMINISTRADOR VARCHAR(20) NOT NULL,
    CANTIDAD_VACUNAS_ACTUALES NUMBER (6,0) NOT NULL,
    PLAN_DE_VACUNACION NUMBER (15,0) NOT NULL
);


-- ////////////////////////////////
--  TABLAS DE CONEXION
-- ////////////////////////////////


--LIST CONDICIONES CIUDADANO
create table LIST_CONDICIONES_CIUDADANO (
    CIUDADANO NUMBER (15,0),
    CONDICION VARCHAR (50)
);

--LIST CONTRAINDICACIONES VACUNA
create table LIST_CONTRAINDICACIONES_VACUNA (
    VACUNA NUMBER (15,0),
    CONDICION VARCHAR (50)
);



-- ////////////////////////////////
--  ENUMERACIONES
-- ////////////////////////////////



--CONDICION
create table CONDICION (
    CONDICIONES VARCHAR (50),
    ETAPA NUMBER (1,0)
);


--PRIORIZACION
create table PRIORIZACION (
    ETAPA NUMBER (1,0)
);


--TIPO_PUNTO_VACUNACION
create table TIPO_PUNTO_VACUNACION (
    TIPO VARCHAR (50)
);


--ESTADO_VACUNACION
create table ESTADO_VACUNACION (
    ESTADO VARCHAR (50)
);


--TRABAJO
create table TRABAJO (
    TRABAJOS VARCHAR (50)
);


--.....................................................
--CREACION DE LLAVES PRIMARIAS
--.....................................................

--CIUDADANO
ALTER TABLE CIUDADANO
ADD CONSTRAINT CEDULA
PRIMARY KEY (CEDULA);


--USUARIO
ALTER TABLE USUARIO
ADD CONSTRAINT USERNAME
PRIMARY KEY (USERNAME);


--PLAN_DE_VACUNACION
ALTER TABLE PLAN_DE_VACUNACION
ADD CONSTRAINT ID_PLAN_DE_VACUNACION
PRIMARY KEY (ID_PLAN_DE_VACUNACION);


--MINISTERIO DE SALUD
ALTER TABLE MINISTERIO_DE_SALUD
ADD CONSTRAINT ID_MINISTERIO
PRIMARY KEY (ID_MINISTERIO);


--PUNTO VACUNACION
ALTER TABLE PUNTO_VACUNACION
ADD CONSTRAINT ID_PUNTO_VACUNACION
PRIMARY KEY (ID_PUNTO_VACUNACION);

--anadir un check para revisar las capacidades de atencion


--CITA
ALTER TABLE CITA
ADD CONSTRAINT ID_CITA
PRIMARY KEY (ID_CITA);


--TRABAJADOR
ALTER TABLE TRABAJADOR
ADD CONSTRAINT CEDULA_TRABAJADOR
PRIMARY KEY (CEDULA);


--VACUNA
ALTER TABLE VACUNA
ADD CONSTRAINT ID_VACUNA
PRIMARY KEY (ID_VACUNA);


--OFICINA REGIONAL EPS
ALTER TABLE OFICINA_REGIONAL_EPS
ADD CONSTRAINT ID_OFICINA
PRIMARY KEY (ID_OFICINA);


-- ////////////////////////////////
--  TABLAS DE CONEXION
-- ////////////////////////////////


--LIST CONDICIONES CIUDADANO
ALTER TABLE LIST_CONDICIONES_CIUDADANO
ADD CONSTRAINT CONDICION_CIUDADANO
PRIMARY KEY (CIUDADANO, CONDICION);

--LIST CONTRAINDICACIONES VACUNA
ALTER TABLE LIST_CONTRAINDICACIONES_VACUNA
ADD CONSTRAINT CONDICION_VACUNA
PRIMARY KEY (VACUNA, CONDICION);


-- ////////////////////////////////
--  ENUMERACIONES
-- ////////////////////////////////



--CONDICION
ALTER TABLE CONDICION
ADD CONSTRAINT CONDICIONES
PRIMARY KEY (CONDICIONES);


--PRIORIZACION
ALTER TABLE PRIORIZACION
ADD CONSTRAINT ETAPA
PRIMARY KEY (ETAPA);


--TIPO_PUNTO_VACUNACION
ALTER TABLE TIPO_PUNTO_VACUNACION
ADD CONSTRAINT TIPO
PRIMARY KEY (TIPO);


--ESTADO_VACUNACION
ALTER TABLE ESTADO_VACUNACION
ADD CONSTRAINT ESTADO
PRIMARY KEY (ESTADO);


--TRABAJO
ALTER TABLE TRABAJO
ADD CONSTRAINT TRABAJOS
PRIMARY KEY (TRABAJOS);



--.....................................................
--CREACION DE RESTRICCIONES
--.....................................................

--CIUDADANO
ALTER TABLE CIUDADANO
ADD CONSTRAINT ESTADO_VACUNACION_CIUDADANO
FOREIGN KEY (ESTADO_VACUNACION) REFERENCES ESTADO_VACUNACION(ESTADO);

ALTER TABLE CIUDADANO
ADD CONSTRAINT PLAN_DE_VACUNACION_CIUDADANO
FOREIGN KEY (PLAN_DE_VACUNACION) REFERENCES PLAN_DE_VACUNACION(ID_PLAN_DE_VACUNACION);

ALTER TABLE CIUDADANO
ADD CONSTRAINT PUNTO_VACUNACION_CIUDADANO
FOREIGN KEY (PUNTO_VACUNACION) REFERENCES PUNTO_VACUNACION(ID_PUNTO_VACUNACION);

ALTER TABLE CIUDADANO
ADD CONSTRAINT OFICINA_REGIONAL_ASIGNADA_CIUDADANO
FOREIGN KEY (OFICINA_REGIONAL_ASIGNADA) REFERENCES OFICINA_REGIONAL_EPS (ID_OFICINA);


--USUARIO
ALTER TABLE USUARIO
ADD CONSTRAINT CORREO_UNICO
UNIQUE (CORREO);

ALTER TABLE USUARIO
ADD CONSTRAINT PLAN_DE_VACUNACION_USUARIO
FOREIGN KEY (PLAN_DE_VACUNACION) REFERENCES PLAN_DE_VACUNACION(ID_PLAN_DE_VACUNACION);

ALTER TABLE USUARIO
ADD CONSTRAINT CIUDADANO_USUARIO
FOREIGN KEY (CIUDADANO) REFERENCES CIUDADANO(CEDULA);

ALTER TABLE USUARIO
ADD CONSTRAINT CEDULA_UNICA
UNIQUE (CIUDADANO);


--PLAN_DE_VACUNACION

ALTER TABLE PLAN_DE_VACUNACION
ADD CONSTRAINT NOMBRE_UNICO
UNIQUE (NOMBRE);


--ALTER TABLE PLAN_DE_VACUNACION 
--ADD CONSTRAINT FECHA_ANTES_DE_ACTUALIDAD 
--CHECK (FECHA_ACTUALIZACION >= );

     
--MINISTERIO DE SALUD
ALTER TABLE MINISTERIO_DE_SALUD
ADD CONSTRAINT MINISTERIO_PLAN_DE_VACUNACION
FOREIGN KEY (PLAN_DE_VACUNACION) REFERENCES PLAN_DE_VACUNACION(ID_PLAN_DE_VACUNACION);


--PUNTO VACUNACION
ALTER TABLE PUNTO_VACUNACION
ADD CONSTRAINT LOCALIZACION_UNICA
UNIQUE (LOCALIZACION);

ALTER TABLE PUNTO_VACUNACION
ADD CONSTRAINT PUNTO_VACUNACION_TIPO_PUNTO_VACUNACION
FOREIGN KEY (TIPO_PUNTO_VACUNACION) REFERENCES TIPO_PUNTO_VACUNACION(TIPO);

ALTER TABLE PUNTO_VACUNACION
ADD CONSTRAINT ADMINISTRADOR_PUNTO_VACUNACIONES
FOREIGN KEY (ADMINISTRADOR) REFERENCES USUARIO(USERNAME);

ALTER TABLE PUNTO_VACUNACION
ADD CONSTRAINT OFICINA_REGIONAL_EPS_PUNTO_VACUNACIONES
FOREIGN KEY (OFICINA_REGIONAL_EPS) REFERENCES OFICINA_REGIONAL_EPS(ID_OFICINA);



--CITA

--ACAAAA HACE FALTA LA VERIFICACION DE LA FECHAAAAAA

ALTER TABLE CITA
ADD CONSTRAINT CITA_CIUDADANO
FOREIGN KEY (CIUDADANO) REFERENCES CIUDADANO(CEDULA);

ALTER TABLE CITA
ADD CONSTRAINT PUNTO_VACUNACION_CITA
FOREIGN KEY (PUNTO_VACUNACION) REFERENCES PUNTO_VACUNACION(ID_PUNTO_VACUNACION);

ALTER TABLE CITA
ADD CONSTRAINT VACUNA_CITA
FOREIGN KEY (VACUNA) REFERENCES VACUNA(ID_VACUNA);

ALTER TABLE CITA
ADD CONSTRAINT VACUNA_UNICA
UNIQUE (VACUNA);


--TRABAJADOR
ALTER TABLE TRABAJADOR
ADD CONSTRAINT TRABAJADOR_CIUDADANO
FOREIGN KEY (CEDULA) REFERENCES CIUDADANO(CEDULA);

ALTER TABLE TRABAJADOR
ADD CONSTRAINT TRABAJADOR_TRABAJO
FOREIGN KEY (TRABAJO) REFERENCES TRABAJO(TRABAJOS);

ALTER TABLE TRABAJADOR
ADD CONSTRAINT TRABAJADOR_PUNTO_VACUNACION
FOREIGN KEY (PUNTO_VACUNACION) REFERENCES PUNTO_VACUNACION(ID_PUNTO_VACUNACION);


--VACUNA
ALTER TABLE VACUNA
ADD CONSTRAINT VACUNA_PUNTO_VACUNACION
FOREIGN KEY (PUNTO_VACUNACION) REFERENCES PUNTO_VACUNACION(ID_PUNTO_VACUNACION);

ALTER TABLE VACUNA
ADD CONSTRAINT VACUNA_PLAN_DE_VACUNACION
FOREIGN KEY (PLAN_DE_VACUNACION) REFERENCES PLAN_DE_VACUNACION(ID_PLAN_DE_VACUNACION);

ALTER TABLE VACUNA
ADD CONSTRAINT OFICINA_REGIONAL_VACUNA
FOREIGN KEY (OFICINA_REGIONAL) REFERENCES OFICINA_REGIONAL_EPS (ID_OFICINA);


--OFICINA REGIONAL EPS
ALTER TABLE OFICINA_REGIONAL_EPS
ADD CONSTRAINT ADMINISTRADOR_OFICINA_REGIONAL_EPS
FOREIGN KEY (ADMINISTRADOR) REFERENCES USUARIO(USERNAME);

ALTER TABLE OFICINA_REGIONAL_EPS
ADD CONSTRAINT OFICINA_REGIONAL_EPS_PLAN_DE_VACUNACION
FOREIGN KEY (PLAN_DE_VACUNACION) REFERENCES PLAN_DE_VACUNACION(ID_PLAN_DE_VACUNACION);

ALTER TABLE OFICINA_REGIONAL_EPS
ADD CONSTRAINT REGION_UNICA
UNIQUE (REGION);


-- ////////////////////////////////
--  TABLAS DE CONEXION
-- ////////////////////////////////


--LIST CONDICIONES CIUDADANO
ALTER TABLE LIST_CONDICIONES_CIUDADANO
ADD CONSTRAINT LIST_CONDICIONES_CIUDADANO_CIUDADANO
FOREIGN KEY (CIUDADANO) REFERENCES CIUDADANO(CEDULA);

ALTER TABLE LIST_CONDICIONES_CIUDADANO
ADD CONSTRAINT LIST_CONDICIONES_CIUDADANO_CONDICION
FOREIGN KEY (CONDICION) REFERENCES CONDICION(CONDICIONES);


--LIST CONTRAINDICACIONES VACUNA
ALTER TABLE LIST_CONTRAINDICACIONES_VACUNA
ADD CONSTRAINT LIST_CONTRAINDICACIONES_VACUNA_VACUNA
FOREIGN KEY (VACUNA) REFERENCES VACUNA(ID_VACUNA);

ALTER TABLE LIST_CONTRAINDICACIONES_VACUNA
ADD CONSTRAINT LIST_CONTRAINDICACIONES_VACUNA_CONDICION
FOREIGN KEY (CONDICION) REFERENCES CONDICION(CONDICIONES);



-- ////////////////////////////////
--  ENUMERACIONES
-- ////////////////////////////////



--CONDICION
ALTER TABLE CONDICION
ADD CONSTRAINT CONDICION_PRIORIZACION
FOREIGN KEY (ETAPA) REFERENCES PRIORIZACION(ETAPA);

--PRIORIZACION

--TIPO_PUNTO_VACUNACION

--ESTADO_VACUNACION

--TRABAJO


--.....................................................
--CONTENIDO ENUMERACIONES
--.....................................................


INSERT INTO ESTADO_VACUNACION (ESTADO) VALUES ('Vacunado');
INSERT INTO ESTADO_VACUNACION (ESTADO) VALUES ('No vacunado');
INSERT INTO ESTADO_VACUNACION (ESTADO) VALUES ('Primera dosis');

INSERT INTO PRIORIZACION (ETAPA) VALUES (1);
INSERT INTO PRIORIZACION (ETAPA) VALUES (2);
INSERT INTO PRIORIZACION (ETAPA) VALUES (3);
INSERT INTO PRIORIZACION (ETAPA) VALUES (4);
INSERT INTO PRIORIZACION (ETAPA) VALUES (5);

INSERT INTO TIPO_PUNTO_VACUNACION (TIPO) VALUES ('Hospital');
INSERT INTO TIPO_PUNTO_VACUNACION (TIPO) VALUES ('Clinica');
INSERT INTO TIPO_PUNTO_VACUNACION (TIPO) VALUES ('Centro de salud');
INSERT INTO TIPO_PUNTO_VACUNACION (TIPO) VALUES ('Otro');

INSERT INTO TRABAJO (TRABAJOS) VALUES ('Administrador plan de vacunacion');
INSERT INTO TRABAJO (TRABAJOS) VALUES ('Administrador punto vacunacion');
INSERT INTO TRABAJO (TRABAJOS) VALUES ('Operador punto vacunacion');
INSERT INTO TRABAJO (TRABAJOS) VALUES ('Administrador oficina punto regional eps');
INSERT INTO TRABAJO (TRABAJOS) VALUES ('Talento humano punto vacunacion');

INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('Adulto mayor (+80)', 1);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('THS servicio social obligatorio', 1);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('THS contacto directo', 1);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('THS servicios generales', 1);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('Tecnico y epidemiologo', 1);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('Adulto mayor (60-79)', 2);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('THS establecimiento carcelario', 2);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('THS tradicional', 2);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('THS estudiante', 2);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('Condicion vulnerable', 3);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('Agente educativo', 3);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('Funcionario publico', 3);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('THS funerarias', 3);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('Privado de libertad', 4);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('Bombero o socorrista', 4);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('Habitante de calle', 4);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('Trabajador aereo', 4);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('Adulto (50-59)', 5);
INSERT INTO CONDICION (CONDICIONES, ETAPA) VALUES ('Adulto (16-49)', 5);
